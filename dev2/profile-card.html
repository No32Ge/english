<style>
    .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; width: 300px; font-family: sans-serif; background: #fff;}
    .info { margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 4px;}
    button { cursor: pointer; padding: 5px 10px; margin-right: 5px;}
</style>

<template>
    <div class="card">
        <h3>用户资料 V2.1</h3>
        
        <div class="info">
            <!-- 绑定深层数据 -->
            <p>Name: <b s-text="user.name"></b></p>
            <p>Age: <span s-text="user.age"></span></p>
        </div>

        <p>Clicks: <span s-text="count">0</span></p>

        <button s-on="click:addAge">年龄 +1</button>
        <button s-on="click:addCount">点击 +1</button>
    </div>
</template>

<script>
    // 1. 初始化数据
    $state.count = 0;
    
    // 初始化复杂对象
    $state.user = {
        name: 'Guest',
        age: 18
    };

    // 2. 定义方法
    $methods.addAge = () => {
        // 方法 A (推荐): 使用解构产生新对象，确保数据纯净
        // $state.user = { ...$state.user, age: $state.user.age + 1 };
        
        // 方法 B (兼容): 直接修改引用，V2.1 引擎已支持
        const u = $state.user;
        u.age++;
        $state.user = u; 
        
        console.log('Age updated to:', u.age);
    };

    $methods.addCount = () => {
        $state.count++;
    };
    
    // 监听外部传入的 props 'username'
    $watch('username', (val) => {
        if(val) {
            const u = $state.user;
            u.name = val;
            $state.user = u;
        }
    });
</script>