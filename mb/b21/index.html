<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Sraian EN">
    <meta property="og:description" content="nothing beats Sraian English">
    <meta property="og:image" content="https://ge32english.com/ge32/labs/GeSeed/v1/res/icon.png">
    <meta property="og:url" content="https://ge32english.com/ge32/labs/GeSeed/v1/home.html">
    <meta property="og:type" content="website">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#000000">
    <title>Schala's Magic Book</title>
    <!-- ä½¿ç”¨Bootstrapç®€åŒ–æ ·å¼ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="icon" href="./res/img/png/icon.png">
    <link rel="stylesheet" href="./css/menu.css">
    <link rel="stylesheet" href="./css/addGram.css">
    <link rel="stylesheet" href="./css/addVocab.css">
    <link rel="stylesheet" href="./css/catalog.css">
    <link rel="stylesheet" href="./css/export.css">
    <link rel="stylesheet" href="./css/import.css">
    <link rel="stylesheet" href="./css/importFromJs.css">
    <link rel="stylesheet" href="./css/article/head.css">
    <link rel="stylesheet" href="./css/article/paragraph.css">
    <link rel="stylesheet" href="./css/article/chineseContent.css">
    <link rel="stylesheet" href="./css/common/speaker.css">
    <link rel="stylesheet" href="./css/common/delete.css">
    <link rel="stylesheet" href="./css/article/vocab-list.css">
    <link rel="stylesheet" href="./css/article//grammer.css">
    <link rel="stylesheet" href="./css/article/englishText.css">
    <link rel="stylesheet" href="./css/page/container.css">
</head>

<body>

    <div class="container" id='Sraian'>
        <!-- <div class="bg"></div> -->
        <div class="header">
            <h1 id="page-title">Sraiané˜…è¯»å™¨</h1>
            <div class="info-bar" id="info-area">
                <!-- ä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        <div class="content" id="content-area">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="footer">
            <p>Created by Lil Geos | Spotlight 0.1</p>
        </div>
    </div>
    <div class="word-tooltip" id="word-tooltip"></div>
    <!-- å·¥å…·æç¤ºå®¹å™¨ -->
    <div id="slot-tooltip" class="slot-tooltip"></div>
    <script>
        console.log("b21")
        const contentArea = document.getElementById("content-area");
        // ä¸­è‹±æ–‡å†…å®¹
        const texts = {
            en: {
                name: "Name: Spotlight",
                author: "Author: Ge32 (Yu Jian)",
                purpose: "Purpose: Learn English",
                version: "Version: 2.1",
                description: "",
                where: "log:"
            },
            zh: {
                name: "åŠŸèƒ½æµ‹è¯•",
                author: "ä½œè€…ï¼šGe32ï¼ˆä½™å¥ï¼‰",
                purpose: "ç”¨é€”ï¼šå­¦è‹±è¯­",
                version: "ç‰ˆæœ¬ï¼š2.1",
                description: "ç¬¬ä¸€æ¬¡åŠ è½½é€Ÿåº¦ç¨å¾®æ…¢ä¸€ç‚¹ã€‚ä¹‹åå†æ¬¡åŠ è½½é€Ÿåº¦å°±å¿«äº†",
                where: "æ—¥å¿—:"
            }
        };
        // æ£€æµ‹æµè§ˆå™¨è¯­è¨€
        const lang = navigator.language.startsWith("zh") ? "zh" : "en";
        const t = texts[lang];
        // æ¸²æŸ“
        contentArea.innerHTML = `
        <div style="margin-bottom:4px;">${t.name}</div>
        <div style="margin-bottom:4px;">${t.author}</div>
        <div style="margin-bottom:4px;">${t.purpose}</div>
        <div style="margin-bottom:4px;">${t.version}</div>
        <div style="margin-bottom:4px;">${t.description}
            <div id="where" style="margin-top:2px;">${t.where}</div>
        </div>
    `;
    </script>
    <script>

        (function () {
            'use strict';

            // å·¥å…·å‡½æ•°ï¼šä»URLæå–è§†é¢‘ID
            function extractVideoId(url) {
                const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                const match = url.match(regex);
                return match ? match[1] : null;
            }

            // é»˜è®¤æ’­æ”¾å™¨é€‰é¡¹
            const defaultOptions = {
                autoplay: 0,
                controls: 0,
                rel: 0,
                mute: 0,
                enablejsapi: 1,
                modestbranding: 1,
                fs: 1,
                playsinline: 1
            };

            // é»˜è®¤è§†é¢‘æ’­æ”¾åˆ—è¡¨
            const defaultPlaylist = [
                { title: "ç¤ºä¾‹è§†é¢‘1", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ" },
                { title: "ç¤ºä¾‹è§†é¢‘2", url: "https://www.youtube.com/watch?v=9bZkp7q19f0" },
                { title: "ç¤ºä¾‹è§†é¢‘3", url: "https://www.youtube.com/watch?v=JGwWNGJdvx8" },
                { title: "ç¤ºä¾‹è§†é¢‘4", url: "https://www.youtube.com/watch?v=kJQP7kiw5Fk" }
            ];

            // YouTubeæ’­æ”¾å™¨ç±»
            class YouTubePlayer {
                static youtubeAPIReady = false;
                static playerQueue = [];

                constructor(containerId, playlist = defaultPlaylist, options = {}) {
                    this.containerId = containerId;
                    this.playlist = playlist;
                    this.currentVideoIndex = 0;
                    this.options = { ...defaultOptions, ...options };
                    this.player = null;
                    this.isReady = false;
                    this.isMuted = false;
                    this.lastVolume = 100;
                    this.isPlaying = false;

                    // åˆ›å»ºDOMç»“æ„å¹¶åˆå§‹åŒ–æ’­æ”¾å™¨
                    this.createDOM();
                    this.init();
                }

                // åˆ›å»ºDOMç»“æ„
                createDOM() {
                    const container = document.getElementById(this.containerId);
                    if (!container) {
                        console.error(`æ‰¾ä¸åˆ°IDä¸º"${this.containerId}"çš„å®¹å™¨å…ƒç´ `);
                        return;
                    }

                    const currentVideo = this.playlist[this.currentVideoIndex];

                    container.innerHTML = `
                <div class="youtube-player-container" id="${this.containerId}-container" style="position: relative; width: 100%; max-width: 800px; margin: 20px auto; background: #1a1a1a; border-radius: 12px; overflow: hidden;">
                    <!-- æ’­æ”¾åˆ—è¡¨æ§åˆ¶æ  -->
                    <div class="playlist-controls" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: #2a2a2a; border-bottom: 1px solid #444;">
                        <div class="playlist-info" style="color: white; font-size: 14px; font-weight: bold;">
                            æ’­æ”¾åˆ—è¡¨ (${this.currentVideoIndex + 1}/${this.playlist.length})
                        </div>
                        <div class="playlist-nav" style="display: flex; gap: 10px;">
                            <button class="nav-btn prev-btn" id="${this.containerId}-prevBtn" style="background: #444; border: none; color: white; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                <i class="fas fa-chevron-left"></i> ä¸Šä¸€ä¸ª
                            </button>
                            <button class="nav-btn next-btn" id="${this.containerId}-nextBtn" style="background: #444; border: none; color: white; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                ä¸‹ä¸€ä¸ª <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- è§†é¢‘æ ‡é¢˜ -->
                    <div class="video-title" id="${this.containerId}-title" style="color: white; padding: 10px 15px; font-size: 16px; font-weight: bold; background: #2a2a2a;">
                        ${currentVideo.title}
                    </div>
                    
                    <div class="youtube-player-wrapper" style="position: relative; width: 100%;">
                        <div id="${this.containerId}-player" class="youtube-player" style="width: 100%; height: 450px;"></div>
                        
                        <!-- é€æ˜è¦†ç›–å±‚ - é˜»æ­¢ä¸YouTube iframeçš„ç›´æ¥äº¤äº’ -->
                        <div class="youtube-overlay" id="${this.containerId}-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; cursor: pointer;"></div>
                        
                        <!-- è‡ªå®šä¹‰æ§åˆ¶æ  -->
                        <div class="custom-controls" id="${this.containerId}-controls" style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.7)); padding: 20px 10px 10px; z-index: 20;">
                            <div class="progress-container" id="${this.containerId}-progress-container" style="height: 6px; background: rgba(255,255,255,0.3); border-radius: 3px; margin-bottom: 10px; cursor: pointer;">
                                <div class="progress-bar" id="${this.containerId}-progress-bar" style="height: 100%; background: #ff0000; border-radius: 3px; width: 0%; position: relative;">
                                    <div class="progress-handle" style="position: absolute; right: -6px; top: 50%; transform: translateY(-50%); width: 12px; height: 12px; background: #ff0000; border-radius: 50%; display: none;"></div>
                                </div>
                            </div>
                            <div class="controls-bottom" style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="control-group" style="display: flex; align-items: center; gap: 10px;">
                                    <button class="control-btn" id="${this.containerId}-playPauseBtn" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 5px;">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="control-btn" id="${this.containerId}-replayBtn" style="background: none; border: none; color: white; font-size: 16px; cursor: pointer; padding: 5px;">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                    <div class="volume-control" style="display: flex; align-items: center; gap: 5px;">
                                        <button class="control-btn" id="${this.containerId}-volumeBtn" style="background: none; border: none; color: white; font-size: 16px; cursor: pointer; padding: 5px;">
                                            <i class="fas fa-volume-up"></i>
                                        </button>
                                        <div class="volume-slider" id="${this.containerId}-volume-slider" style="width: 60px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; cursor: pointer;">
                                            <div class="volume-level" id="${this.containerId}-volume-level" style="height: 100%; background: white; border-radius: 2px; width: 100%;"></div>
                                        </div>
                                    </div>
                                    <span class="time-display" id="${this.containerId}-time" style="color: white; font-size: 14px; font-family: Arial, sans-serif;">0:00 / 0:00</span>
                                </div>
                                <div class="control-group">
                                    <button class="control-btn" id="${this.containerId}-fullscreenBtn" style="background: none; border: none; color: white; font-size: 16px; cursor: pointer; padding: 5px;">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ’­æ”¾åˆ—è¡¨ -->
                    <div class="playlist-container" style="max-height: 200px; overflow-y: auto; background: #2a2a2a;">
                        ${this.playlist.map((video, index) => `
                            <div class="playlist-item ${index === this.currentVideoIndex ? 'active' : ''}" 
                                 data-index="${index}"
                                 style="padding: 10px 15px; border-bottom: 1px solid #444; cursor: pointer; color: ${index === this.currentVideoIndex ? '#ff0000' : 'white'}; background: ${index === this.currentVideoIndex ? '#333' : 'transparent'};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>${index + 1}. ${video.title}</span>
                                    ${index === this.currentVideoIndex ? '<i class="fas fa-play" style="color: #ff0000;"></i>' : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
                }

                // åˆå§‹åŒ–æ’­æ”¾å™¨
                init() {
                    const currentVideo = this.playlist[this.currentVideoIndex];
                    if (!currentVideo || !extractVideoId(currentVideo.url)) {
                        console.error("æ— æ³•ä»URLä¸­æå–è§†é¢‘ID");
                        return;
                    }

                    // å°†æ’­æ”¾å™¨æ·»åŠ åˆ°é˜Ÿåˆ—
                    YouTubePlayer.playerQueue.push(this);

                    // å¦‚æœAPIå·²å‡†å¤‡å°±ç»ªï¼Œç›´æ¥åˆ›å»ºæ’­æ”¾å™¨
                    if (YouTubePlayer.youtubeAPIReady) {
                        this.createYTPlayer();
                    } else {
                        // å¦åˆ™ç­‰å¾…APIåŠ è½½
                        this.loadYouTubeAPI();
                    }
                }

                // åŠ è½½YouTube API
                loadYouTubeAPI() {
                    // å¦‚æœå·²ç»åœ¨åŠ è½½ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›
                    if (window.YT) return;

                    // åˆ›å»ºè„šæœ¬å…ƒç´ 
                    const tag = document.createElement('script');
                    tag.src = 'https://www.youtube.com/iframe_api';
                    const firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    // è®¾ç½®å…¨å±€å›è°ƒå‡½æ•°
                    window.onYouTubeIframeAPIReady = () => {
                        YouTubePlayer.youtubeAPIReady = true;
                        console.log("YouTube API å·²åŠ è½½");

                        // å¤„ç†é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ’­æ”¾å™¨
                        YouTubePlayer.playerQueue.forEach(player => {
                            player.createYTPlayer();
                        });

                        // æ¸…ç©ºé˜Ÿåˆ—
                        YouTubePlayer.playerQueue.length = 0;
                    };
                }

                // åˆ›å»ºYouTubeæ’­æ”¾å™¨å®ä¾‹
                createYTPlayer() {
                    const currentVideo = this.playlist[this.currentVideoIndex];
                    console.log(`åˆ›å»ºæ’­æ”¾å™¨: ${this.containerId}, è§†é¢‘ID: ${extractVideoId(currentVideo.url)}`);

                    this.player = new YT.Player(`${this.containerId}-player`, {
                        videoId: extractVideoId(currentVideo.url),
                        playerVars: this.options,
                        events: {
                            'onReady': (event) => this.onPlayerReady(event),
                            'onStateChange': (event) => this.onPlayerStateChange(event)
                        }
                    });

                    // ç»‘å®šæ§ä»¶äº‹ä»¶
                    this.bindControlEvents();
                }

                // ç»‘å®šæ§åˆ¶äº‹ä»¶
                bindControlEvents() {
                    const playPauseBtn = document.getElementById(`${this.containerId}-playPauseBtn`);
                    const replayBtn = document.getElementById(`${this.containerId}-replayBtn`);
                    const fullscreenBtn = document.getElementById(`${this.containerId}-fullscreenBtn`);
                    const progressContainer = document.getElementById(`${this.containerId}-progress-container`);
                    const volumeBtn = document.getElementById(`${this.containerId}-volumeBtn`);
                    const volumeSlider = document.getElementById(`${this.containerId}-volume-slider`);
                    const overlay = document.getElementById(`${this.containerId}-overlay`);
                    const prevBtn = document.getElementById(`${this.containerId}-prevBtn`);
                    const nextBtn = document.getElementById(`${this.containerId}-nextBtn`);
                    const playlistItems = document.querySelectorAll(`#${this.containerId}-container .playlist-item`);

                    // æ’­æ”¾/æš‚åœ
                    playPauseBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.togglePlayPause();
                    });

                    // é‡æ–°æ’­æ”¾
                    replayBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.replay();
                    });

                    // å…¨å±
                    fullscreenBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.toggleFullscreen();
                    });

                    // è¿›åº¦æ¡ç‚¹å‡»
                    progressContainer.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (!this.player || !this.player.getDuration) return;

                        const rect = progressContainer.getBoundingClientRect();
                        const percent = (e.clientX - rect.left) / rect.width;
                        const newTime = this.player.getDuration() * percent;

                        this.player.seekTo(newTime);
                        this.updateProgressBar();
                    });

                    // éŸ³é‡æ§åˆ¶
                    volumeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.toggleMute();
                    });

                    volumeSlider.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (!this.player) return;

                        const rect = volumeSlider.getBoundingClientRect();
                        const percent = (e.clientX - rect.left) / rect.width;
                        const volume = Math.max(0, Math.min(100, Math.round(percent * 100)));

                        this.setVolume(volume);
                    });

                    // ä¸ºè¦†ç›–å±‚æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    overlay.addEventListener('click', () => {
                        this.togglePlayPause();
                    });

                    // é˜»æ­¢è¦†ç›–å±‚ä¸Šçš„å³é”®èœå•
                    overlay.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        return false;
                    });

                    // ä¸Šä¸€ä¸ªè§†é¢‘
                    prevBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.previousVideo();
                    });

                    // ä¸‹ä¸€ä¸ªè§†é¢‘
                    nextBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.nextVideo();
                    });

                    // æ’­æ”¾åˆ—è¡¨é¡¹ç‚¹å‡»
                    playlistItems.forEach(item => {
                        item.addEventListener('click', (e) => {
                            const index = parseInt(item.getAttribute('data-index'));
                            this.loadVideoByIndex(index);
                        });
                    });

                    // é»˜è®¤å¯ç”¨è¦†ç›–å±‚
                    overlay.style.display = 'block';
                }

                // æ’­æ”¾å™¨å‡†å¤‡å°±ç»ªå›è°ƒ
                onPlayerReady(event) {
                    console.log(`æ’­æ”¾å™¨ ${this.containerId} å‡†å¤‡å°±ç»ª`);
                    this.isReady = true;
                    this.updateTimeDisplay();
                    this.updateProgressBar();

                    // åˆå§‹åŒ–éŸ³é‡
                    if (this.player && this.player.getVolume) {
                        this.updateVolumeUI(this.player.getVolume());
                    }
                }

                // æ’­æ”¾å™¨çŠ¶æ€æ”¹å˜å›è°ƒ
                onPlayerStateChange(event) {
                    this.updatePlayPauseButton(event.data);

                    // å¦‚æœè§†é¢‘ç»“æŸï¼Œè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ª
                    if (event.data === YT.PlayerState.ENDED) {
                        this.updatePlayPauseButton(YT.PlayerState.PAUSED);
                        // è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ªè§†é¢‘
                        setTimeout(() => {
                            this.nextVideo();
                        }, 1000);
                    }
                }

                // åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªè§†é¢‘
                previousVideo() {
                    if (this.currentVideoIndex > 0) {
                        this.loadVideoByIndex(this.currentVideoIndex - 1);
                    } else {
                        // å¾ªç¯åˆ°æœ€åä¸€ä¸ªè§†é¢‘
                        this.loadVideoByIndex(this.playlist.length - 1);
                    }
                }

                // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè§†é¢‘
                nextVideo() {
                    if (this.currentVideoIndex < this.playlist.length - 1) {
                        this.loadVideoByIndex(this.currentVideoIndex + 1);
                    } else {
                        // å¾ªç¯åˆ°ç¬¬ä¸€ä¸ªè§†é¢‘
                        this.loadVideoByIndex(0);
                    }
                }

                // æ ¹æ®ç´¢å¼•åŠ è½½è§†é¢‘
                loadVideoByIndex(index) {
                    if (index < 0 || index >= this.playlist.length) return;

                    this.currentVideoIndex = index;
                    const video = this.playlist[index];

                    // æ›´æ–°UI
                    this.updatePlaylistUI();

                    // å¦‚æœæ’­æ”¾å™¨å·²å­˜åœ¨ï¼ŒåŠ è½½æ–°è§†é¢‘
                    if (this.player && this.player.loadVideoById) {
                        this.player.loadVideoById({
                            videoId: extractVideoId(video.url),
                            startSeconds: 0
                        });
                        this.updatePlayPauseButton(YT.PlayerState.PLAYING);
                    } else {
                        // é‡æ–°åˆ›å»ºæ’­æ”¾å™¨
                        this.createDOM();
                        this.init();
                    }
                }

                // æ›´æ–°æ’­æ”¾åˆ—è¡¨UI
                updatePlaylistUI() {
                    const titleElement = document.getElementById(`${this.containerId}-title`);
                    const playlistInfo = document.querySelector(`#${this.containerId}-container .playlist-info`);
                    const playlistItems = document.querySelectorAll(`#${this.containerId}-container .playlist-item`);

                    if (titleElement) {
                        titleElement.textContent = this.playlist[this.currentVideoIndex].title;
                    }

                    if (playlistInfo) {
                        playlistInfo.textContent = `æ’­æ”¾åˆ—è¡¨ (${this.currentVideoIndex + 1}/${this.playlist.length})`;
                    }

                    playlistItems.forEach((item, index) => {
                        const isActive = index === this.currentVideoIndex;
                        item.style.color = isActive ? '#ff0000' : 'white';
                        item.style.background = isActive ? '#333' : 'transparent';

                        const icon = item.querySelector('i');
                        if (icon) {
                            icon.style.display = isActive ? 'inline' : 'none';
                        }
                    });
                }

                // æ’­æ”¾
                play() {
                    if (this.player) {
                        this.player.playVideo();
                        this.isPlaying = true;
                    }
                }

                // æš‚åœ
                pause() {
                    if (this.player) {
                        this.player.pauseVideo();
                        this.isPlaying = false;
                    }
                }

                // åˆ‡æ¢æ’­æ”¾/æš‚åœ
                togglePlayPause() {
                    if (!this.player) return;

                    if (this.player.getPlayerState() === YT.PlayerState.PLAYING) {
                        this.pause();
                    } else {
                        this.play();
                    }
                }

                // é‡æ–°æ’­æ”¾
                replay() {
                    if (this.player) {
                        this.player.seekTo(0);
                        this.play();
                        this.updatePlayPauseButton(YT.PlayerState.PLAYING);
                    }
                }

                // è®¾ç½®éŸ³é‡
                setVolume(volume) {
                    if (this.player) {
                        this.player.setVolume(volume);
                        this.player.unMute();
                        this.isMuted = false;
                        this.updateVolumeUI(volume);
                    }
                }

                // åˆ‡æ¢é™éŸ³
                toggleMute() {
                    if (!this.player) return;

                    if (this.isMuted) {
                        this.player.unMute();
                        this.player.setVolume(this.lastVolume);
                        this.isMuted = false;
                        this.updateVolumeUI(this.lastVolume);
                    } else {
                        this.lastVolume = this.player.getVolume();
                        this.player.mute();
                        this.isMuted = true;
                        this.updateVolumeUI(0);
                    }
                }

                // åˆ‡æ¢å…¨å±
                toggleFullscreen() {
                    const container = document.getElementById(`${this.containerId}-container`);
                    const fullscreenBtn = document.getElementById(`${this.containerId}-fullscreenBtn`);
                    const icon = fullscreenBtn.querySelector('i');

                    if (!document.fullscreenElement) {
                        // è¿›å…¥å…¨å±
                        if (container.requestFullscreen) {
                            container.requestFullscreen();
                        } else if (container.webkitRequestFullscreen) {
                            container.webkitRequestFullscreen();
                        } else if (container.msRequestFullscreen) {
                            container.msRequestFullscreen();
                        }

                        icon.className = 'fas fa-compress';
                    } else {
                        // é€€å‡ºå…¨å±
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        } else if (document.msExitFullscreen) {
                            document.msExitFullscreen();
                        }

                        icon.className = 'fas fa-expand';
                    }
                }

                // æ›´æ–°æ’­æ”¾/æš‚åœæŒ‰é’®çŠ¶æ€
                updatePlayPauseButton(state) {
                    const button = document.getElementById(`${this.containerId}-playPauseBtn`);
                    const icon = button.querySelector('i');

                    if (state === YT.PlayerState.PLAYING) {
                        icon.className = 'fas fa-pause';
                        this.isPlaying = true;
                    } else {
                        icon.className = 'fas fa-play';
                        this.isPlaying = false;
                    }
                }

                // æ›´æ–°è¿›åº¦æ¡
                updateProgressBar() {
                    if (!this.player || !this.player.getDuration || !this.player.getCurrentTime) return;

                    const progressBar = document.getElementById(`${this.containerId}-progress-bar`);
                    const duration = this.player.getDuration();
                    const current = this.player.getCurrentTime();
                    const percent = (current / duration) * 100;

                    progressBar.style.width = `${percent}%`;
                }

                // æ›´æ–°éŸ³é‡UI
                updateVolumeUI(volume) {
                    const volumeLevel = document.getElementById(`${this.containerId}-volume-level`);
                    const volumeBtn = document.getElementById(`${this.containerId}-volumeBtn`);
                    const icon = volumeBtn.querySelector('i');

                    volumeLevel.style.width = `${volume}%`;

                    if (volume === 0) {
                        icon.className = 'fas fa-volume-mute';
                    } else if (volume < 50) {
                        icon.className = 'fas fa-volume-down';
                    } else {
                        icon.className = 'fas fa-volume-up';
                    }
                }

                // æ›´æ–°æ—¶é—´æ˜¾ç¤º
                updateTimeDisplay() {
                    if (!this.player || !this.player.getDuration) return;

                    const timeElem = document.getElementById(`${this.containerId}-time`);
                    const duration = this.player.getDuration();
                    const current = this.player.getCurrentTime();
                    const formatTime = (t) => `${Math.floor(t / 60)}:${Math.floor(t % 60).toString().padStart(2, '0')}`;
                    timeElem.textContent = `${formatTime(current)} / ${formatTime(duration)}`;

                    // æ›´æ–°è¿›åº¦æ¡
                    this.updateProgressBar();

                    // å®šæœŸæ›´æ–°
                    setTimeout(() => this.updateTimeDisplay(), 500);
                }

                // æ·»åŠ è§†é¢‘åˆ°æ’­æ”¾åˆ—è¡¨
                addVideo(title, url) {
                    this.playlist.push({ title, url });
                    this.createDOM();
                    this.bindControlEvents();
                }

                // ä»æ’­æ”¾åˆ—è¡¨ç§»é™¤è§†é¢‘
                removeVideo(index) {
                    if (index >= 0 && index < this.playlist.length) {
                        this.playlist.splice(index, 1);
                        if (this.currentVideoIndex >= index && this.currentVideoIndex > 0) {
                            this.currentVideoIndex--;
                        }
                        this.createDOM();
                        this.bindControlEvents();
                    }
                }

                // é”€æ¯æ’­æ”¾å™¨
                destroy() {
                    if (this.player) {
                        this.player.destroy();
                        this.player = null;
                    }

                    const container = document.getElementById(this.containerId);
                    if (container) {
                        container.innerHTML = '';
                    }
                }
            }

            // å°†ç±»æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
            window.YouTubePlayer = YouTubePlayer;

            window.customPlaylist = [

                { title: "lofi hip hop radio ğŸ“š beats to relax/study to", url: "https://www.youtube.com/watch?v=jfKfPfyJRdk" },
                { title: "synthwave radio ğŸŒŒ beats to chill/game to", url: "https://www.youtube.com/watch?v=4xDzrJKXOOY" },
                { title: "SCHALA'S Magic Bookä¸»é¢˜", url: "https://www.youtube.com/watch?v=bQ6kaNcsw4Q&list=RDbQ6kaNcsw4Q&start_radio=1" },
                { title: "last fall - lil peep(æˆ‘å–œæ¬¢çš„æ­Œ)", url: "https://www.youtube.com/watch?v=IpVUNNaZLHw&list=RDIpVUNNaZLHw&start_radio=1" },
            ];

            // è‡ªåŠ¨æ³¨å…¥ç¤ºä¾‹
            function autoInject() {
                // æ£€æŸ¥é¡µé¢æ˜¯å¦å·²ç»æœ‰æ’­æ”¾å™¨å®¹å™¨
                if (!document.getElementById('youtube-player-container')) {
                    // åˆ›å»ºå®¹å™¨
                    const container = document.createElement('div');
                    container.id = 'youtube-player-container';
                    container.style.position = 'fixed';
                    container.style.top = '20px';
                    container.style.right = '20px';
                    container.style.width = '500px';
                    container.style.zIndex = '10000';
                    container.style.background = 'transparent';
                    container.style.borderRadius = '12px';
                    container.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';

                    document.body.appendChild(container);

                    // è‡ªå®šä¹‰æ’­æ”¾åˆ—è¡¨
                    // const  = 

                    // åˆ›å»ºæ’­æ”¾å™¨å®ä¾‹
                    const player = new YouTubePlayer('youtube-player-container', customPlaylist);
                    console.log('YouTubeæ’­æ”¾å™¨ï¼ˆå¸¦è§†é¢‘åˆ‡æ¢ï¼‰å·²è‡ªåŠ¨æ³¨å…¥');

                    // æ·»åŠ å¿«æ·é”®æ”¯æŒ
                    document.addEventListener('keydown', (e) => {
                        if (e.altKey && e.key === 'ArrowLeft') {
                            player.previousVideo();
                        } else if (e.altKey && e.key === 'ArrowRight') {
                            player.nextVideo();
                        } else if (e.altKey && e.key === ' ') {
                            player.togglePlayPause();
                        }
                    });
                }
            }

            // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ³¨å…¥
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', autoInject);
            } else {
                autoInject();
            }

            console.log('%cGE32 YouTubeæ’­æ”¾å™¨è„šæœ¬æ’ä»¶', "font-size: 30px; color: green; font-weight: bold;");
            console.log('%cä½œè€…å…¬ä¼—å· ï¼š Ge32', "font-size: 30px; color: black; font-weight: bold;");
        })();
    </script>
    <script>

        const logs = [];
        function logStep(msg) {
            logs.push(msg);
            document.getElementById("where").innerHTML = logs.map((e, i) => `<div>${i} ${e}</div>`).join("");
        }
        document.addEventListener('initStep', e => logStep(e.detail));
    </script>
    <script type="module" src="./main.js">
        ready({ version: "1.0", status: "ready" });
    </script>

    <script>
        (async function () {
            // 1. æ‹‰å–è¿œç¨‹ç‰ˆæœ¬å·ï¼ˆå¼ºåˆ¶ä¸ç¼“å­˜ï¼‰
            let remoteConfig = null;
            try {
                const res = await fetch(`/version.json?t=${Date.now()}`);
                remoteConfig = await res.json();
            } catch (e) {
                console.warn("version.json åŠ è½½å¤±è´¥");
            }
            if (!remoteConfig) return;

            const localVersion = localStorage.getItem('appVersion');

            // 2. æ³¨å†Œ SW
            if (!('serviceWorker' in navigator)) return;

            try {
                const reg = await navigator.serviceWorker.register('/service-worker.js');

                // å°è£…ï¼šå‘ SW å‘é€é…ç½®
                function sendConfig() {
                    if (reg.active) {
                        reg.active.postMessage({
                            type: 'SET_CONFIG',
                            payload: remoteConfig
                        });
                    }
                }

                // æƒ…å†µ 1ï¼šSW ä¸€å¼€å§‹å°±å·²ç» active
                if (reg.active) sendConfig();

                // æƒ…å†µ 2ï¼šSW è¿˜æ²¡ activeï¼ˆå®‰è£…ä¸­ï¼‰
                reg.addEventListener('updatefound', () => {
                    const newWorker = reg.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'activated') {
                            sendConfig();
                            // åªåœ¨ SW æ¿€æ´»æ—¶ reload ä¸€æ¬¡
                            location.reload();
                        }
                    });
                });

                // 3. ç‰ˆæœ¬å·å¯¹æ¯”ï¼ˆåªè§¦å‘ä¸€æ¬¡ reloadï¼‰
                if (remoteConfig.version !== localVersion) {
                    console.log(`Version updated: ${localVersion} -> ${remoteConfig.version}`);
                    localStorage.setItem('appVersion', remoteConfig.version);
                    // ç»™ SW ç•™æ—¶é—´å¤„ç†æ¶ˆæ¯
                    setTimeout(() => location.reload(), 300);
                }

            } catch (error) {
                console.error('SW registration failed:', error);
            }
        })();
    </script>
</body>

</html>