<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å…¨åœºæ™¯ç»ˆææ¼”ç¤º</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f7f9fc; padding: 30px; }
        .grid { display: flex; gap: 30px; flex-wrap: wrap; margin-top: 20px; }
        
        /* æ—¥å¿—åŒºåŸŸæ ·å¼ */
        #console-log {
            margin-top: 30px; padding: 15px; background: #2d3436; 
            color: #00b894; border-radius: 8px; font-family: monospace;
            height: 150px; overflow-y: auto;
        }
    </style>
</head>
<body>

    <!-- 1. [ä¸»é¡µ Raw Import] åŸç”Ÿæ¨¡æ¿å®¹å™¨ -->
    <div id="top-banner-area"></div>

    <h1>ğŸ  æ™ºèƒ½å®¶å±…æ§åˆ¶ä¸­å¿ƒ</h1>
    
    <button onclick="masterSwitch('on')">ğŸ”¥ ä¸€é”®å…¨å¼€æ¨¡å¼</button>
    <button onclick="masterSwitch('off')">ğŸŒ‘ ä¸€é”®å…¨å…³æ¨¡å¼</button>

    <div class="grid">
        <!-- 2. [Web Component] å®ä¾‹åŒ–ç»„ä»¶ -->
        <!-- ä¼ é€’ title å±æ€§ï¼Œå®ƒä¼šé€šè¿‡ s-bind ä¼ ç»™å†…éƒ¨ -->
        <smart-room id="living-room" title="ğŸ›‹ï¸ å®¢å…"></smart-room>
        
        <smart-room id="bed-room" title="ğŸ›ï¸ å§å®¤"></smart-room>
    </div>

    <div id="console-log">ç­‰å¾…è®¾å¤‡æ“ä½œ...</div>

    <!-- å¼•å…¥å¼•æ“ -->
    <script type="module">
        import { registerComponent, importHtml } from './ComponentLoader.js';

        // --- A. æ³¨å†Œç»„ä»¶ (Web Component) ---
        // åªéœ€æ³¨å†Œæœ€å¤–å±‚çš„ smart-room
        registerComponent('smart-room', './smart-room.html');


        // --- B. åŠ è½½åŸç”Ÿæ¨¡æ¿ (Raw Import in Main) ---
        // éœ€æ±‚ï¼šåœ¨ä¸»htmlé‡Œé¢å¯¼å…¥å¦å¤–ä¸¤ä¸ªæ¨¡æ¿(ä¸€ä¸ªç”¨åˆ°web compmentï¼Œä¸€ä¸ªæ²¡æœ‰)
        // è¿™é‡Œçš„ weather-header.html å°±æ˜¯é‚£ä¸ªâ€œæ²¡æœ‰ç”¨åˆ° web componentâ€çš„çº¯æ¨¡æ¿
        async function loadHeader() {
            const headerNode = await importHtml('./weather-header.html');
            document.getElementById('top-banner-area').appendChild(headerNode);
            console.log("ä¸»é¡µ: å¤©æ°”æ¨ªå¹…å·²åŠ è½½");
        }
        loadHeader();


        // --- C. äº¤äº’é€»è¾‘ ---
        const logBox = document.getElementById('console-log');
        const room1 = document.getElementById('living-room');
        const room2 = document.getElementById('bed-room');

        // ç›‘å¬ç»„ä»¶å†…éƒ¨å†’æ³¡å‡ºæ¥çš„äº‹ä»¶
        // device-switch (å‘ toggle) -> smart-room (å†’æ³¡) -> index.html (æ•è·)
        document.addEventListener('toggle-device', (e) => {
            const msg = `[${new Date().toLocaleTimeString()}] æ”¶åˆ°äº‹ä»¶: è®¾å¤‡ "${e.detail.name}" å˜æˆäº† ${e.detail.state ? 'å¼€' : 'å…³'}`;
            const p = document.createElement('div');
            p.textContent = msg;
            logBox.prepend(p);
        });

        // æ¼”ç¤º Props Down: ä¸»é¡µæ§åˆ¶æ‰€æœ‰æˆ¿é—´
        window.masterSwitch = (mode) => {
            // æˆ‘ä»¬ä¿®æ”¹ smart-room çš„ 'master' å±æ€§
            // smart-room å†…éƒ¨ç›‘å¬ 'master'ï¼Œç„¶åä¿®æ”¹ lightStatus/acStatus
            // lightStatus å˜äº† -> device-switch æ¥æ”¶åˆ° active å˜åŒ– -> è‡ªåŠ¨åˆ‡æ¢å¼€å…³
            room1.setAttribute('master', mode);
            room2.setAttribute('master', mode);
        };

    </script>
</body>
</html>