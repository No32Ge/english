<style>
    .switch-item {
        display: flex; justify-content: space-between; align-items: center;
        padding: 10px; border-bottom: 1px solid #f0f0f0;
    }
    .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #ccc; margin-right: 8px;}
    .status-dot.on { background: #10b981; }
    
    button { padding: 4px 12px; border-radius: 15px; border: 1px solid #ccc; background: white; cursor: pointer; }
    button.active { background: #10b981; color: white; border-color: #10b981; }
</style>

<template>
    <div class="switch-item">
        <div>
            <!-- s-class: 动态变色 -->
            <span class="status-dot" s-class="isOn"></span>
            <span s-text="deviceName">设备名</span>
        </div>
        <!-- s-on: 点击触发 toggle -->
        <button s-class="isOn" s-on="click:toggle">
            <span s-text="btnText">OFF</span>
        </button>
    </div>
</template>

<script>
    $state.isOn = false;
    $state.deviceName = '未知设备';
    $state.btnText = 'OFF';

    // 1. 监听父组件传来的 'name'
    $watch('name', (val) => $state.deviceName = val);
    
    // 2. 监听父组件传来的 'active' (字符串 "true"/"false")
    $watch('active', (val) => {
        const isActive = val === 'true';
        $state.isOn = isActive;
        $state.btnText = isActive ? 'ON' : 'OFF';
    });

    // 3. 内部点击 -> 触发事件通知父组件
    $state.toggle = () => {
        // 先乐观更新 UI
        const newState = !$state.isOn;
        $state.isOn = newState;
        $state.btnText = newState ? 'ON' : 'OFF';
        
        // 发送事件 'toggle-device'
        $emit('toggle-device', { 
            name: $state.deviceName, 
            state: newState 
        });
    }
</script>